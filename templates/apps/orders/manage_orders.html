{% extends "layouts/base.html" %}

{% load static %}

{% block extrastyle %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.tailwindcss.min.css">
{% endblock extrastyle %}

{% block content %}
<main>
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Manage Orders</h1>
    <div class="mb-4">
      <h2 class="text-xl font-semibold">Order Information</h2>
      <p>Order Token: {{ order.order_token }}</p>
      <p>Client: {{ order.client.username }}</p>
      <p>Status: {{ order.get_status_display }}</p>
      <p>Total Amount: {{ order.total_amount }}</p>
      <p>Delivery Address: {{ order.delivery_address }}</p>
      <p>Payment Method: {{ order.get_payment_method_display }}</p>
      <p>Payment Status: {{ order.get_payment_status_display }}</p>
      <p>Discount: {{ order.discount }}% ({{ order.get_discount_type_display }})</p>
    </div>
    <div class="mb-4">
      <h2 class="text-xl font-semibold">Order Items</h2>
      <form method="post" action="{% url 'order_details' order.id %}">
        {% csrf_token %}
        {% for item in order.order_items.all %}
          <div class="mb-4">
            <label for="product" class="block mb-2 text-sm font-medium text-gray-700">Product</label>
            <select name="product" id="product_{{ item.id }}" class="form-select bg-white border border-gray-300 text-gray-700 rounded">
              <option value="{{ item.content_object.id }}">{{ item.content_object }}</option>
            </select>
            <label for="quantity" class="block mb-2 text-sm font-medium text-gray-700">Quantity</label>
            <input type="number" name="quantity" id="quantity_{{ item.id }}" class="form-input bg-white border border-gray-300 text-gray-700 rounded" value="{{ item.quantity }}" min="1">
            <label for="price" class="block mb-2 text-sm font-medium text-gray-700">Price</label>
            <input type="number" name="price" id="price_{{ item.id }}" class="form-input bg-white border border-gray-300 text-gray-700 rounded" value="{{ item.price }}" step="0.01">
          </div>
        {% endfor %}
        <button type="submit" class="btn btn-primary">Update Order</button>
      </form>
    </div>
    <div class="mb-4">
      <h2 class="text-xl font-semibold">Change Order Status</h2>
      <form method="post" action="{% url 'change_order_status' order.id %}">
        {% csrf_token %}
        <div class="mb-4">
          <label for="status" class="block mb-2 text-sm font-medium text-gray-700">New Status</label>
          <select name="status" id="status" class="form-select bg-white border border-gray-300 text-gray-700 rounded">
            {% for status in order.ORDER_STATUS_CHOICES %}
              <option value="{{ status.0 }}" {% if order.status == status.0 %}selected{% endif %}>{{ status.1 }}</option>
            {% endfor %}
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Change Status</button>
      </form>
    </div>
    <div class="mb-4">
      <h2 class="text-xl font-semibold">Make Payment</h2>
      <form method="post" action="{% url 'make_payment' order.id %}">
        {% csrf_token %}
        <div class="mb-4">
          <label for="amount" class="block mb-2 text-sm font-medium text-gray-700">Amount</label>
          <input type="number" name="amount" id="amount" class="form-input bg-white border border-gray-300 text-gray-700 rounded" placeholder="Enter amount" step="0.01">
        </div>
        <button type="submit" class="btn btn-primary">Make Payment</button>
      </form>
    </div>
    <div class="mb-4">
      <h2 class="text-xl font-semibold">Return Debt</h2>
      <form method="post" action="{% url 'return_debt' order.id %}">
        {% csrf_token %}
        <div class="mb-4">
          <label for="amount" class="block mb-2 text-sm font-medium text-gray-700">Amount</label>
          <input type="number" name="amount" id="amount" class="form-input bg-white border border-gray-300 text-gray-700 rounded" placeholder="Enter amount" step="0.01">
        </div>
        <button type="submit" class="btn btn-primary">Return Debt</button>
      </form>
    </div>
  </div>
</main>
{% endblock content %}
